'use strict';(function(){var e=new Worker(`${window.kdSumerianHostPath}audio-worker.js`),g,c,k=function(d,a){a=a||{};a.time=a.hasOwnProperty("time")?a.time:1500;a.amplitude=a.hasOwnProperty("amplitude")?a.amplitude:.2;var b=!1,f,n,p,q,r=d.context.createScriptProcessor(4096,1,1);e.onmessage=function(h){f(h.data)};e.postMessage({command:"init",config:{sampleRate:d.context.sampleRate}});r.onaudioprocess=function(h){if(b){e.postMessage({command:"record",buffer:[h.inputBuffer.getChannelData(0)]});l.fftSize=
2048;h=l.fftSize;var m=new Uint8Array(h),u=a.amplitude,w=a.time;l.getByteTimeDomainData(m);"function"===typeof q&&q(m,h);for(var t=0;t<h;t++){var v=m[t]/128-1;if(v>u||v<-1*u)n=Date.now()}Date.now()-n>w&&p()}};var l=d.context.createAnalyser();l.minDecibels=-90;l.maxDecibels=-10;l.smoothingTimeConstant=.85;d.connect(l);l.connect(r);r.connect(d.context.destination);return{record:function(h,m){p=h;q=m;n=Date.now();b=!0},stop:function(){b=!1},clear:function(){b=!1;e.postMessage({command:"clear"})},exportWAV:function(h,
m){f=h;e.postMessage({command:"export",sampleRate:m})}}};window.audioRecorder=function(){return{requestDevice:function(){"undefined"===typeof g&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,g=new AudioContext);return navigator.mediaDevices.getUserMedia({audio:!0}).then(function(d){c=d})},createRecorder:function(d){return k(g.createMediaStreamSource(c),d)},audioContext:function(){return g}}}})();
(function(){var e,g,c,k;window.audioControl=function(d){d=d||{};this.checkAudioSupport=!1!==d.checkAudioSupport;d=function(a){a=a||function(){};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(g=window.audioRecorder(),g.requestDevice().then(function(b){c=!0;a(c)}).catch(function(b){c=!1;a(c)})):(c=!1,a(c))};this.checkAudioSupport&&d();return{startRecording:function(a,b,f){a=a||function(){};b=b||function(){};c=!1!==c;if(!c)throw Error("Audio is not supported.");e||(e=g.createRecorder(f));
e.record(a,b)},stopRecording:function(){c=!1!==c;if(!c)throw Error("Audio is not supported.");e&&e.stop()},exportWAV:function(a,b){c=!1!==c;if(!c)throw Error("Audio is not supported.");if(!a||"function"!==typeof a)throw Error("You must pass a callback function to export.");e.exportWAV(a,"undefined"!==typeof b?b:16E3);e.clear()},play:function(a,b){if("undefined"!==typeof a){a=new Blob([a]);var f=new FileReader;f.onload=function(){k=g.audioContext().createBufferSource();g.audioContext().decodeAudioData(this.result,
function(n){k.buffer=n;k.connect(g.audioContext().destination);k.onended=function(p){"function"===typeof b&&b()};k.start(0)})};f.readAsArrayBuffer(a)}},stop:function(){"undefined"!==typeof k&&k.stop()},clear:function(){e.clear()},playHtmlAudioElement:function(a,b){if("undefined"!==typeof a){a=new Blob([a]);var f=document.createElement("audio");a=window.URL.createObjectURL(a);f.src=a;f.addEventListener("ended",function(){f.currentTime=0;"function"===typeof b&&b()});f.play()}},supportsAudio:d}}})();
